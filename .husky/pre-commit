#!/bin/bash

# Pre-commit hook for Personal Finance App
# Runs linting, formatting, and type checks before commit

echo "NPM format..."
npm run format

echo "ğŸ” Running pre-commit checks..."

# Get the project root directory (where .git is located)
PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

# Check PHP formatting
echo "ğŸ“ Checking PHP formatting..."
if ! vendor/bin/pint --dirty -v; then
    echo "âŒ PHP formatting check failed. Please fix with: vendor/bin pint --dirty"
    exit 1
fi

# Check JavaScript formatting
echo "ğŸ“ Checking JavaScript formatting..."
if ! npm run format:check 2>&1; then
    echo "âŒ JavaScript formatting check failed. Please fix with: npm run format"
    exit 1
fi

# Check JavaScript linting
echo "ğŸ” Running JavaScript linting..."
if ! npm run lint 2>&1; then
    echo "âŒ JavaScript linting failed. Please fix the errors above."
    exit 1
fi

# Check TypeScript types
echo "ğŸ“ Checking TypeScript types..."
if ! npm run types 2>&1; then
    echo "âŒ TypeScript type check failed. Please fix the type errors above."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"
exit 0
